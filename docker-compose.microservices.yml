version: '3.8'

services:
  # API Gateway
  api-gateway:
    build:
      context: .
      dockerfile: apps/backend/api-gateway/Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - PORT=3000
      - AUTH_SERVICE_URL=http://auth-service:3001
      - FLIGHT_SERVICE_URL=http://flight-service:3002
      - HOTEL_SERVICE_URL=http://hotel-service:3003
      - ADMIN_SERVICE_URL=http://admin-service:3004
    depends_on:
      - auth-service
      - flight-service
    volumes:
      - ./apps/backend/api-gateway:/app
      - /app/node_modules
    networks:
      - travel-network

  # Auth Service
  auth-service:
    build:
      context: .
      dockerfile: apps/backend/auth-service/Dockerfile
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
      - PORT=3001
      - DATABASE_URL=file:./auth.db
      - JWT_SECRET=your-super-secret-jwt-key-for-auth-service-development
      - REFRESH_SECRET=your-super-secret-refresh-key-for-auth-service-development
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - GOOGLE_REDIRECT_URI=http://localhost:3001/api/auth/google/callback
    volumes:
      - ./apps/backend/auth-service:/app
      - /app/node_modules
      - auth-db:/app/prisma
    networks:
      - travel-network

  # Flight Service
  flight-service:
    build:
      context: .
      dockerfile: apps/backend/flight-service/Dockerfile
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=development
      - PORT=3002
      - DATABASE_URL=file:./flights.db
      - AUTH_SERVICE_URL=http://auth-service:3001
      - AMADEUS_API_KEY=${AMADEUS_API_KEY:-dummy_api_key}
      - AMADEUS_API_SECRET=${AMADEUS_API_SECRET:-dummy_api_secret}
      - AMADEUS_BASE_URL=https://test.api.amadeus.com
    volumes:
      - ./apps/backend/flight-service:/app
      - /app/node_modules
      - flights-db:/app/prisma
    depends_on:
      - auth-service
    networks:
      - travel-network

  # Hotel Service
  hotel-service:
    build:
      context: .
      dockerfile: apps/backend/hotel-service/Dockerfile
    ports:
      - "3003:3003"
    environment:
      - NODE_ENV=development
      - PORT=3003
      - DATABASE_URL=file:./hotels.db
      - AUTH_SERVICE_URL=http://auth-service:3001
      - RATEHAWK_API_KEY=${RATEHAWK_API_KEY:-dummy_api_key}
      - RATEHAWK_BASE_URL=https://api.ratehawk.com
    volumes:
      - ./apps/backend/hotel-service:/app
      - /app/node_modules
      - hotels-db:/app/prisma
    depends_on:
      - auth-service
    networks:
      - travel-network

  # Admin Service
  admin-service:
    build:
      context: .
      dockerfile: apps/backend/admin-service/Dockerfile
    ports:
      - "3004:3004"
    environment:
      - NODE_ENV=development
      - PORT=3004
      - AUTH_SERVICE_URL=http://auth-service:3001
      - FLIGHT_SERVICE_URL=http://flight-service:3002
      - HOTEL_SERVICE_URL=http://hotel-service:3003
    volumes:
      - ./apps/backend/admin-service:/app
      - /app/node_modules
    depends_on:
      - auth-service
      - flight-service
      - hotel-service
    networks:
      - travel-network

volumes:
  auth-db:
  flights-db:
  hotels-db:

networks:
  travel-network:
    driver: bridge