generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/@prisma/client"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// User management and authentication - Separate tables for different user types

// Individual consumer users (B2C)
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String?  // nullable for Google OAuth users
  firstName String
  lastName  String
  isActive  Boolean  @default(true)
  googleId  String?  @unique
  avatar    String?
  
  // Personal Information
  dateOfBirth DateTime?
  phoneNumber String?
  nationality String?
  
  // Address Information
  address     String?
  city        String?
  state       String?
  country     String?
  postalCode  String?
  
  // Identity Verification
  idType      String?   // "passport", "drivers_license", "national_id"
  idNumber    String?
  idExpiryDate DateTime?
  
  // KYC Status
  kycStatus   String    @default("PENDING") // "PENDING", "VERIFIED", "REJECTED"
  kycDocuments String?   // Store document URLs and metadata as JSON string
  verifiedAt  DateTime?
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Bookings relation
  bookings Booking[]

  @@map("users")
}

// Business users (B2B)
model Business {
  id              String    @id @default(uuid())
  email           String    @unique
  password        String?   // nullable for Google OAuth users
  googleId        String?   @unique
  isActive        Boolean   @default(true)
  
  // Business Information
  companyName     String
  businessType    String?   // "corporation", "llc", "partnership", "sole_proprietorship"
  registrationNumber String?
  taxId           String?
  industry        String?
  businessDescription String?
  website         String?
  
  // Business Address
  businessAddress String?
  businessCity    String?
  businessState   String?
  businessCountry String?
  businessPostalCode String?
  
  // Contact Information
  businessPhone   String?
  businessEmail   String?
  
  // Legal Representative
  representativeName String
  representativeTitle String?
  representativePhone String?
  representativeEmail String?
  
  // Business Documents
  businessLicense String?
  incorporationCertificate String?
  taxCertificate  String?
  
  // Banking Information
  bankName        String?
  accountNumber   String?
  routingNumber   String?
  
  // KYC Status
  kycStatus       String    @default("PENDING") // "PENDING", "VERIFIED", "REJECTED"
  kycDocuments    String?   // Store document URLs and metadata as JSON string
  verifiedAt      DateTime?
  
  // Business Metrics
  annualRevenue   Float?
  employeeCount   Int?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  businessBookings BusinessBooking[]

  @@map("businesses")
}

// Admin users with elevated permissions - only @flybeth domain
model Admin {
  id        String   @id @default(uuid())
  email     String   @unique // must be @flybeth.com domain
  password  String?  // nullable for Google OAuth users
  firstName String
  lastName  String
  role      String   @default("ADMIN") // "ADMIN", "SUPER_ADMIN", "SUPPORT"
  isActive  Boolean  @default(true)
  googleId  String?  @unique
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

// Flight bookings and information
model Flight {
  id            String   @id @default(uuid())
  flightNumber  String
  airline       String
  origin        String
  destination   String
  departureTime DateTime
  arrivalTime   DateTime
  price         Float
  currency      String   @default("USD")
  seats         Int
  aircraft      String?
  status        String   @default("ACTIVE") // "ACTIVE", "CANCELLED", "DELAYED"
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  bookings         FlightBooking[]
  businessBookings BusinessFlightBooking[]

  @@map("flights")
}

model FlightBooking {
  id        String   @id @default(uuid())
  flightId  String
  flight    Flight   @relation(fields: [flightId], references: [id])
  bookingId String
  booking   Booking  @relation(fields: [bookingId], references: [id])
  
  seatNumber String?
  seatClass  String   @default("ECONOMY") // "ECONOMY", "BUSINESS", "FIRST"
  price      Float
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("flight_bookings")
}

model BusinessFlightBooking {
  id               String          @id @default(uuid())
  flightId         String
  flight           Flight          @relation(fields: [flightId], references: [id])
  businessBookingId String
  businessBooking  BusinessBooking @relation(fields: [businessBookingId], references: [id])
  
  seatNumber String?
  seatClass  String   @default("ECONOMY") // "ECONOMY", "BUSINESS", "FIRST"
  price      Float
  
  // Business traveler information
  travelerName  String
  travelerEmail String?
  employeeId    String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("business_flight_bookings")
}

// Hotel bookings and information
model Hotel {
  id          String   @id @default(uuid())
  name        String
  description String?
  address     String
  city        String
  country     String
  rating      Float?
  pricePerNight Float
  currency    String   @default("USD")
  amenities   String?  // JSON string of amenities
  images      String?  // JSON string of image URLs
  status      String   @default("ACTIVE") // "ACTIVE", "INACTIVE"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  rooms            HotelRoom[]
  bookings         HotelBooking[]
  businessBookings BusinessHotelBooking[]

  @@map("hotels")
}

model HotelRoom {
  id          String   @id @default(uuid())
  hotelId     String
  hotel       Hotel    @relation(fields: [hotelId], references: [id])
  
  roomType    String   // "SINGLE", "DOUBLE", "SUITE", "DELUXE"
  capacity    Int
  price       Float
  amenities   String?  // JSON string of room amenities
  isAvailable Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  bookings         HotelBooking[]
  businessBookings BusinessHotelBooking[]

  @@map("hotel_rooms")
}

model HotelBooking {
  id        String   @id @default(uuid())
  hotelId   String
  hotel     Hotel    @relation(fields: [hotelId], references: [id])
  roomId    String
  room      HotelRoom @relation(fields: [roomId], references: [id])
  bookingId String
  booking   Booking  @relation(fields: [bookingId], references: [id])
  
  checkIn   DateTime
  checkOut  DateTime
  guests    Int
  price     Float
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("hotel_bookings")
}

model BusinessHotelBooking {
  id               String          @id @default(uuid())
  hotelId          String
  hotel            Hotel           @relation(fields: [hotelId], references: [id])
  roomId           String
  room             HotelRoom       @relation(fields: [roomId], references: [id])
  businessBookingId String
  businessBooking  BusinessBooking @relation(fields: [businessBookingId], references: [id])
  
  checkIn   DateTime
  checkOut  DateTime
  guests    Int
  price     Float
  
  // Business traveler information
  guestName     String
  guestEmail    String?
  employeeId    String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("business_hotel_bookings")
}

// Unified booking system for individual users
model Booking {
  id           String   @id @default(uuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id])
  
  bookingType  String   // "FLIGHT", "HOTEL", "PACKAGE"
  status       String   @default("PENDING") // "PENDING", "CONFIRMED", "CANCELLED", "COMPLETED"
  totalAmount  Float
  currency     String   @default("USD")
  
  // Payment information
  paymentStatus String  @default("PENDING") // "PENDING", "PAID", "FAILED", "REFUNDED"
  paymentMethod String? // "CREDIT_CARD", "PAYPAL", "BANK_TRANSFER"
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  flightBookings FlightBooking[]
  hotelBookings  HotelBooking[]

  @@map("bookings")
}

// Business booking system for corporate bookings
model BusinessBooking {
  id           String   @id @default(uuid())
  businessId   String
  business     Business @relation(fields: [businessId], references: [id])
  
  bookingType  String   // "FLIGHT", "HOTEL", "PACKAGE"
  status       String   @default("PENDING") // "PENDING", "CONFIRMED", "CANCELLED", "COMPLETED"
  totalAmount  Float
  currency     String   @default("USD")
  
  // Payment information
  paymentStatus String  @default("PENDING") // "PENDING", "PAID", "FAILED", "REFUNDED"
  paymentMethod String? // "CREDIT_CARD", "PAYPAL", "BANK_TRANSFER", "NET30"
  
  // Business-specific fields
  poNumber     String? // Purchase order number
  approvedBy   String? // Name of person who approved the booking
  costCenter   String? // Internal cost center code
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  businessFlightBookings BusinessFlightBooking[]
  businessHotelBookings  BusinessHotelBooking[]

  @@map("business_bookings")
}